- name: Install zellij from GitHub release
  ansible.builtin.shell: |
    cd /tmp
    curl -fLo zellij.tar.gz "https://github.com/zellij-org/zellij/releases/latest/download/zellij-{{ ansible_architecture }}-unknown-linux-musl.tar.gz"
    tar -xzf zellij.tar.gz
    install -m 0755 zellij /usr/local/bin/zellij
    rm -f zellij.tar.gz zellij
  args:
    creates: /usr/local/bin/zellij

- name: Install Debian-specific packages
  ansible.builtin.apt:
    name: "{{ base_packages_debian }}"
    state: present
    update_cache: true

- name: Add GitHub CLI GPG key
  ansible.builtin.shell: |
    install -m 0755 -d /etc/apt/keyrings
    curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg -o /etc/apt/keyrings/githubcli-archive-keyring.gpg
    chmod a+r /etc/apt/keyrings/githubcli-archive-keyring.gpg
  args:
    creates: /etc/apt/keyrings/githubcli-archive-keyring.gpg

- name: Add GitHub CLI APT repository
  ansible.builtin.apt_repository:
    repo: "deb [arch={{ ansible_architecture | regex_replace('x86_64', 'amd64') }} signed-by=/etc/apt/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main"
    state: present

- name: Install GitHub CLI
  ansible.builtin.apt:
    name: gh
    state: present
    update_cache: true

- name: Add Kubernetes GPG key
  ansible.builtin.shell: |
    install -m 0755 -d /etc/apt/keyrings
    curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.32/deb/Release.key | gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
    chmod a+r /etc/apt/keyrings/kubernetes-apt-keyring.gpg
  args:
    creates: /etc/apt/keyrings/kubernetes-apt-keyring.gpg

- name: Add Kubernetes APT repository
  ansible.builtin.apt_repository:
    repo: "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.32/deb/ /"
    state: present

- name: Install kubectl
  ansible.builtin.apt:
    name: kubectl
    state: present
    update_cache: true
